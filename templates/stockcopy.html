{% extends 'base.html' %}
{% block content %}
<div id="query-data" data-growth="{{query['growth']}}" data-margin="{{query['margin']}}" data-pe="{{query['pe']}}"
    data-user="{{user}}"></div>
<div class="container text-center my-5">
    <h1 id="stock-ticker">{{data['ticker'][0]}}</h1>
</div>
<!-- <div class="row">

    <div class="col-6">
        <h3>Historical</h3>
    </div>
    <div class="col-6">
        <h3>Forecast</h3>
    </div>
</div> -->
<div class="row my-3">
    <div class="col-3">
        <div class="btn-group btn-group-toggle" data-toggle="buttons" id="view-toggle">
            <label class="btn btn-secondary active">
                <input type="radio" name="options" id="dollar" checked value="0"> $ amount
            </label>
            <label class="btn btn-secondary">
                <input type="radio" name="options" id="perc-growth" value="1"> % growth
            </label>
            <label class="btn btn-secondary">
                <input type="radio" name="options" id="perc-rev" value="2"> % of revenue
            </label>
        </div>
    </div>
    <div class="col-6"></div>
    <div class="col-3">
        <a class="btn btn-primary" id="save-forecast" data-bs-toggle="modal" href="#login-modal" role="button">Save Forecast</a>
    </div>
</div>




<!-- Modal -->
<div class="modal fade" id="login-modal" tabindex="-1" aria-labelledby="login-modal-label"
    aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="login-modal-label">Login</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="container" id="login-flash-msgs">
                </div>
                <form method="POST" id="login-form">
                    {{ login_form.hidden_tag() }}
                    <!--add type=hidden form fields -->

                    {% for field in login_form
                    if field.widget.input_type != 'hidden' %}

                    <p>
                        {{ field.label }}
                        {{ field }}

                        {% for error in field.errors %}
                        {{ error }}
                        {% endfor %}
                    </p>

                    {% endfor %}
                    <div id="login">
                        <button type="submit" class="my-3">Login</button>
                        <p>Don't have an account? <a href="" id="switch-to-signup" data-bs-target="#signup-modal"
                                data-bs-toggle="modal" data-bs-dismiss="modal">Sign up</a></p>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>



<div class="modal fade" id="signup-modal" aria-hidden="true" aria-labelledby="signup-modal-label" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="signup-modal-label">Sign up</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="container" id="signup-flash-msgs">
                </div>
                <form method="POST" id="signup-form">
                    {{ login_form.hidden_tag() }}
                    <!--add type=hidden form fields -->

                    {% for field in login_form
                    if field.widget.input_type != 'hidden' %}

                    <p>
                        {{ field.label }}
                        {{ field }}

                        {% for error in field.errors %}
                        {{ error }}
                        {% endfor %}
                    </p>

                    {% endfor %}
                    <div id="signup">
                        <button type="submit" class="my-3">Sign up</button>
                        <p>Already have an account? <a href="" id="switch-to-login" data-bs-target="#login-modal"
                                data-bs-toggle="modal" data-bs-dismiss="modal">Log in</a></p>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="save-modal" aria-hidden="true" aria-labelledby="save-modal-label" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="signup-modal-label">Save Forecast</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="container" id="signup-flash-msgs">
                </div>
                <form method="POST" id="save-form">
                    {{ save_form.hidden_tag() }}
                    <!--add type=hidden form fields -->
                
                    {% for field in save_form
                    if field.widget.input_type != 'hidden' %}
                
                    <p>
                        {{ field.label }}
                        {{ field }}
                
                        {% for error in field.errors %}
                        {{ error }}
                        {% endfor %}
                    </p>
                
                    {% endfor %}
                    <div id="login">
                        <button type="submit" class="my-3">Save Forecast</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>




<h2>Financials</h2>
<table class="table" id="forecast-table">
    <thead>
        <tr>
            <th scope="col">#</th>
            <th scope="col">{{data['period'][0]}}</th>
            <th scope="col">{{data['period'][1]}}</th>
            <th scope="col">{{data['period'][2]}}</th>
            <th scope="col">{{data['period'][3]}}</th>
            <th scope="col">{{data['period'][3] + 1}}E</th>
            <th scope="col">{{data['period'][3] + 2}}E</th>
            <th scope="col">{{data['period'][3] + 3}}E</th>
            <th scope="col">{{data['period'][3] + 4}}E</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <th scope="row">Revenue <i class="fa-solid fa-circle-question" data-bs-toggle="popover" data-bs-title="Popover title" data-bs-content="And here's some amazing content. It's very engaging. Right?"></i></button></th>
            <td id="hist-revenue0" class="hist">{{data['revenue'][0]}}</td>
            <td id="hist-revenue1" class="hist">{{data['revenue'][1]}}</td>
            <td id="hist-revenue2" class="hist">{{data['revenue'][2]}}</td>
            <td id="hist-revenue3" class="hist">{{data['revenue'][3]}}</td>
            <td><input type="text" class="form-control table-input rev" placeholder="" id="revenue0"></td>
            <td><input type="text" class="form-control table-input rev" placeholder="" id="revenue1"></td>
            <td><input type="text" class="form-control table-input rev" placeholder="" id="revenue2"></td>
            <td><input type="text" class="form-control table-input rev" placeholder="" id="revenue3"></td>
        </tr>
        <tr>
            <th scope="row">Cost of Revenue</th>
            <td id="hist-cogs0" class="hist">{{data['cogs'][0]}}</td>
            <td id="hist-cogs1" class="hist">{{data['cogs'][1]}}</td>
            <td id="hist-cogs2" class="hist">{{data['cogs'][2]}}</td>
            <td id="hist-cogs3" class="hist">{{data['cogs'][3]}}</td>
            <td><input type="text" class="form-control table-input cogs" placeholder="" id="cogs0"></td>
            <td><input type="text" class="form-control table-input cogs" placeholder="" id="cogs1"></td>
            <td><input type="text" class="form-control table-input cogs" placeholder="" id="cogs2"></td>
            <td><input type="text" class="form-control table-input cogs" placeholder="" id="cogs3"></td>
        </tr>
        <tr>
            <th scope="row">Gross Income</th>
            <td id="hist-gross-income0" class="hist">{{data['revenue'][0] - data['cogs'][0]}}</td>
            <td id="hist-gross-income1" class="hist">{{data['revenue'][1] - data['cogs'][1]}}</td>
            <td id="hist-gross-income2" class="hist">{{data['revenue'][2] - data['cogs'][2]}}</td>
            <td id="hist-gross-income3" class="hist">{{data['revenue'][3] - data['cogs'][3]}}</td>
            <td class='calc' id="gross-income0"></td>
            <td class='calc' id="gross-income1"></td>
            <td class='calc' id="gross-income2"></td>
            <td class='calc' id="gross-income3"></td>
        </tr>
        <tr>
            <th scope="row">Operating Expenses</th>
            <td id="hist-opex0" class="hist">{{data['opex'][0]}}</td>
            <td id="hist-opex1" class="hist">{{data['opex'][1]}}</td>
            <td id="hist-opex2" class="hist">{{data['opex'][2]}}</td>
            <td id="hist-opex3" class="hist">{{data['opex'][3]}}</td>
            <td><input type="text" class="form-control table-input opex" placeholder="" id="opex0"></td>
            <td><input type="text" class="form-control table-input opex" placeholder="" id="opex1"></td>
            <td><input type="text" class="form-control table-input opex" placeholder="" id="opex2"></td>
            <td><input type="text" class="form-control table-input opex" placeholder="" id="opex3"></td>
        </tr>
        <tr>
            <th scope="row">Earnings Before Depreciation (EBITDA)</th>
            <td id="hist-ebitda0" class="hist">{{data['revenue'][0] - data['cogs'][0] - data['opex'][0]}}</td>
            <td id="hist-ebitda1" class="hist">{{data['revenue'][1] - data['cogs'][1] - data['opex'][1]}}</td>
            <td id="hist-ebitda2" class="hist">{{data['revenue'][2] - data['cogs'][2] - data['opex'][2]}}</td>
            <td id="hist-ebitda3" class="hist">{{data['revenue'][3] - data['cogs'][3] - data['opex'][3]}}</td>
            <td class='calc' id="ebitda0"></td>
            <td class='calc' id="ebitda1"></td>
            <td class='calc' id="ebitda2"></td>
            <td class='calc' id="ebitda3"></td>
        </tr>
        <tr>
            <th scope="row">Depreciation</th>
            <td id="hist-depreciation0" class="hist">{{data['depreciation'][0]}}</td>
            <td id="hist-depreciation1" class="hist">{{data['depreciation'][1]}}</td>
            <td id="hist-depreciation2" class="hist">{{data['depreciation'][2]}}</td>
            <td id="hist-depreciation3" class="hist">{{data['depreciation'][3]}}</td>
            <td><input type="text" class="form-control table-input depreciation" placeholder="" id="depreciation0"></td>
            <td><input type="text" class="form-control table-input depreciation" placeholder="" id="depreciation1"></td>
            <td><input type="text" class="form-control table-input depreciation" placeholder="" id="depreciation2"></td>
            <td><input type="text" class="form-control table-input depreciation" placeholder="" id="depreciation3"></td>
        </tr>
        <tr>
            <th scope="row">Operating Income</th>
            <td id="hist-operating-income0" class="hist">{{data['revenue'][0] - data['cogs'][0] - data['opex'][0] -
                data['depreciation'][0]}}</td>
            <td id="hist-operating-income1" class="hist">{{data['revenue'][1] - data['cogs'][1] - data['opex'][1] -
                data['depreciation'][1]}}</td>
            <td id="hist-operating-income2" class="hist">{{data['revenue'][2] - data['cogs'][2] - data['opex'][2] -
                data['depreciation'][2]}}</td>
            <td id="hist-operating-income3" class="hist">{{data['revenue'][3] - data['cogs'][3] - data['opex'][3] -
                data['depreciation'][3]}}</td>
            <td class='calc' id="operating-income0"></td>
            <td class='calc' id="operating-income1"></td>
            <td class='calc' id="operating-income2"></td>
            <td class='calc' id="operating-income3"></td>
        </tr>
        <tr>
            <th scope="row">Other Revenue or Expenses</th>
            <td id="hist-other0" class="hist">{{data['other'][0]}}</td>
            <td id="hist-other1" class="hist">{{data['other'][1]}}</td>
            <td id="hist-other2" class="hist">{{data['other'][2]}}</td>
            <td id="hist-other3" class="hist">{{data['other'][3]}}</td>
            <td><input type="text" class="form-control table-input other" placeholder="" id="other0"></td>
            <td><input type="text" class="form-control table-input other" placeholder="" id="other1"></td>
            <td><input type="text" class="form-control table-input other" placeholder="" id="other2"></td>
            <td><input type="text" class="form-control table-input other" placeholder="" id="other3"></td>
        </tr>
        <tr>
            <th scope="row">Net Income Before Tax</th>
            <td id="hist-ebt0" class="hist">{{data['revenue'][0] - data['cogs'][0] - data['opex'][0] -
                data['depreciation'][0] -
                data['other'][0]}}
            </td>
            <td id="hist-ebt1" class="hist">{{data['revenue'][1] - data['cogs'][1] - data['opex'][1] -
                data['depreciation'][1] -
                data['other'][1]}}
            </td>
            <td id="hist-ebt2" class="hist">{{data['revenue'][2] - data['cogs'][2] - data['opex'][2] -
                data['depreciation'][2] -
                data['other'][2]}}
            </td>
            <td id="hist-ebt3" class="hist">{{data['revenue'][3] - data['cogs'][3] - data['opex'][3] -
                data['depreciation'][3] -
                data['other'][3]}}
            </td>
            <td class='calc' id="ebt0"></td>
            <td class='calc' id="ebt1"></td>
            <td class='calc' id="ebt2"></td>
            <td class='calc' id="ebt3"></td>
        </tr>
        <tr>
            <th scope="row">Income Tax Expense</th>
            <td id="hist-tax0" class="hist">{{data['tax'][0]}}</td>
            <td id="hist-tax1" class="hist">{{data['tax'][1]}}</td>
            <td id="hist-tax2" class="hist">{{data['tax'][2]}}</td>
            <td id="hist-tax3" class="hist">{{data['tax'][3]}}</td>
            <td><input type="text" class="form-control table-input tax" placeholder="" id="tax0"></td>
            <td><input type="text" class="form-control table-input tax" placeholder="" id="tax1"></td>
            <td><input type="text" class="form-control table-input tax" placeholder="" id="tax2"></td>
            <td><input type="text" class="form-control table-input tax" placeholder="" id="tax3"></td>
        </tr>
        <tr>
            <th scope="row">Net Income</th>
            <td id="hist-net-income0" class="hist">{{data['net_income'][0]}}</td>
            <td id="hist-net-income1" class="hist">{{data['net_income'][1]}}</td>
            <td id="hist-net-income2" class="hist">{{data['net_income'][2]}}</td>
            <td id="hist-net-income3" class="hist">{{data['net_income'][3]}}</td>
            <td class='calc net-income' id="net-income0"></td>
            <td class='calc net-income' id="net-income1"></td>
            <td class='calc net-income' id="net-income2"></td>
            <td class='calc net-income' id="net-income3"></td>
        </tr>
        <tr>
            <th scope="row">Dividends</th>
            <td id="hist-dividend0" class="hist">{{data['dividend'][0]}}</td>
            <td id="hist-dividend1" class="hist">{{data['dividend'][1]}}</td>
            <td id="hist-dividend2" class="hist">{{data['dividend'][2]}}</td>
            <td id="hist-dividend3" class="hist">{{data['dividend'][3]}}</td>
            <td><input type="text" class="form-control table-input dividend" placeholder="" id="dividend0"></td>
            <td><input type="text" class="form-control table-input dividend" placeholder="" id="dividend1"></td>
            <td><input type="text" class="form-control table-input dividend" placeholder="" id="dividend2"></td>
            <td><input type="text" class="form-control table-input dividend" placeholder="" id="dividend3"></td>
        </tr>
    </tbody>
</table>
<div class="row my-3">
    <div class="container col-6">
        <h2>Valuation</h2>
        <table class="table" id="valuation-table">
            <tbody>
                <tr>
                    <th scope="row">Exit multiple</th>
                    <td><input type="text" class="form-control val pe" placeholder="" id="pe"></td>
                </tr>
                <tr>
                    <th scope="row">Forecasted EPS in {{data['period'][3] + 4}}</th>
                    <td class='calc' id="eps3"></td>
                </tr>
                <tr>
                    <th scope="row">Implied Share price at {{data['period'][3] + 4}}</th>
                    <td class='val' id="price"></td>
                </tr>
                <tr>
                    <th scope="row">Total dividends per share</th>
                    <td class='val' id="divtot"></td>
                </tr>
                <tr>
                    <th scope="row">Target Share price</th>
                    <td class='val' id="target"></td>
                </tr>
                <tr>
                    <th scope="row">Annualized return</th>
                    <td class='val' id="return"></td>
                </tr>
            </tbody>
        </table>
    </div>
    <div class="container col-6">
        <!-- <h2>Insights</h2>
        <h4>Your forecast is 93% more optimistic than analysts</h4> -->
    </div>
</div>
{% endblock %}

{% block script %}
<script src="/static/app.js"></script>
{% endblock %}